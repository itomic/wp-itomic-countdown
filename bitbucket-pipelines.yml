image: php:8.1

pipelines:
  default:
    - step:
        name: PHP Syntax Check
        caches:
          - composer
        script:
          - apt-get update && apt-get install -y git zip unzip
          - php -l itomic-countdown.php
          - php -l uninstall.php
          - find assets -name "*.php" -exec php -l {} \;
        artifacts:
          - deploy/**
    - step:
        name: WordPress Coding Standards
        caches:
          - composer
        script:
          - apt-get update && apt-get install -y git zip unzip
          - composer global require squizlabs/php_codesniffer
          - composer global require wp-coding-standards/wpcs
          - ~/.composer/vendor/bin/phpcs --standard=WordPress itomic-countdown.php
          - ~/.composer/vendor/bin/phpcs --standard=WordPress assets/
        artifacts:
          - deploy/**
    - step:
        name: Build Plugin Package
        script:
          - apt-get update && apt-get install -y git zip unzip
          - chmod +x deploy.sh
          - ./deploy.sh
        artifacts:
          - deploy/**

    branches:
    main:
      - step:
          name: Deploy to Test Server
          script:
            - echo "Deployment disabled - SSH keys not configured"
            - echo "To enable deployment, configure SSH keys in Repository Settings"
            - ./deploy.sh
          artifacts:
            - deploy/**

definitions:
  caches:
    composer: ~/.composer/cache 